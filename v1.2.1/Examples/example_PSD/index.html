<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Plotting PSD of several multicarrier waveforms · DigitalComm.jl</title><meta name="title" content="Plotting PSD of several multicarrier waveforms · DigitalComm.jl"/><meta property="og:title" content="Plotting PSD of several multicarrier waveforms · DigitalComm.jl"/><meta property="twitter:title" content="Plotting PSD of several multicarrier waveforms · DigitalComm.jl"/><meta name="description" content="Documentation for DigitalComm.jl."/><meta property="og:description" content="Documentation for DigitalComm.jl."/><meta property="twitter:description" content="Documentation for DigitalComm.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DigitalComm.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DigitalComm.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction to DigitalComm</a></li><li><a class="tocitem" href="../../base/">Function list</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example_AWGN/">Transmission of xQAM with additive white Gaussian noise</a></li><li><a class="tocitem" href="../example_BER/">Compute the theoretical BER for AWGN channel and various constellation size</a></li><li class="is-active"><a class="tocitem" href>Plotting PSD of several multicarrier waveforms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Plotting PSD of several multicarrier waveforms</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Plotting PSD of several multicarrier waveforms</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaTelecom/DigitalComm.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaTelecom/DigitalComm.jl/blob/master/docs/src/Examples/example_PSD.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Plotting-PSD-of-several-multicarrier-waveforms"><a class="docs-heading-anchor" href="#Plotting-PSD-of-several-multicarrier-waveforms">Plotting PSD of several multicarrier waveforms</a><a id="Plotting-PSD-of-several-multicarrier-waveforms-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-PSD-of-several-multicarrier-waveforms" title="Permalink"></a></h1><p>The purpose is to compre the Power spectral density of several multicarrier waveform. The following module can be used:</p><pre><code class="nohighlight hljs">module example_PSD_waveform 
# ---------------------------------------------------- 
# --- Modules  
# ---------------------------------------------------- 
using DigitalComm 
# --- External Modules
using Plots 
gr();
using Printf
using FFTW
# ---------------------------------------------------- 
# --- Core functions  
# ---------------------------------------------------- 
&quot;&quot;&quot; psdWaveform.m 
---  
Compute the power spectral density (i.e the spectrum here) of the signal parametrized by the waveform structure waveform, for a number of symbol nbSymb.
The frequency allocation is the one inherited from the waveform structure (i.e waveform.allocatedSubcarriers).
# --- Syntax 
( freq,psd )    = psdWaveform(waveform,nbSymb,allocatedSubcarriers);
# ---  Input parameters 
- waveform  : Structure associated to transmitted waveform 
- nbSymb      : Number of symbol to be transmitted [Int]
- nbIt    : Monte carlo parameter for PSD evaluation (should be &gt; 1)
# --- Output parameters 
- freq    : Vector of frequency evaluation (between -0.5 and 0.5). [Array{Float64,L}]
- psd     : Spectrum evaluated on freq [Array{Complex{Float64}},L]
# --- Input parameters 
- 
# --- Output parameters 
- 
# --- 
# v 1.0 - Robin Gerzaguet.
&quot;&quot;&quot;
function  psdWaveform(waveform,nbSymb,nbIt)
    # ----------------------------------------------------
    # --- PSD calculation
    # ---------------------------------------------------- 
    # --- Getting frequency allocation 
    allocatedSubcarriers  = waveform.allocatedSubcarriers;
    # --- Getting number of bits 
    # First, frequency size 
    nbSubcarriers         = length(allocatedSubcarriers);
    # Force a fiven mcs 
    mcs                   = 4;    # QPSK.
    # Deduce number of required bits 
    nbBits                = nbSymb * nbSubcarriers * Int(log2(mcs));
    # --- Init psd evaluator 
    psd = 0;
    # --- Iterative PSD calculation
    for iN = 1 : 1 : nbIt
        # --- Binary sequence
        bitSeq        = genBitSequence(nbBits);
        # Mapping
        qamSeq        = bitMappingQAM(mcs,bitSeq);
        # --- T/F matrix
        qamMat        = reshape(qamSeq,nbSubcarriers,nbSymb);
        # --- Signal
        sigPSD        = genSig(qamMat,waveform);
        # --- Mean PSD:
        psd           = psd .+ 1/nbIt*1/length(sigPSD)*abs.(fftshift(fft(sigPSD))).^2;
    end
    # --- Calculating sampling frequency
    # Returns Nyquist frequency 
    fe      = 1;
    Basefe  = (0:(length(psd) .-1))./length(psd)*fe .-fe/2;
    return (Basefe,psd);
end
# ---------------------------------------------------- 
# --- Main routine  
# ---------------------------------------------------- 
function main()
    # ----------------------------------------------------
    # --- Overall parameters
    # ----------------------------------------------------
    # --- Overall PHY parameters
    nbIt            = 50;             # --- Iteration number
    nbSymb          = 14;             # --- Number of symbols (one frame)
    nFFT            = 1024;           # --- Base FFT size
    samplingFreq    = 15.36;          # --- Frequency value (MHz)
    # --- Frequency allocation
    #allocatedSubcarriers= getLTEAlloc(nFFT);
    #allocatedSubcarriers = (1:12*4);
    # 4 RB alloc. 1 RB space. 4 RB allocated
    allocatedSubcarriers = [1:12*4; 12*5 .+ (1:12*4)];
    # ----------------------------------------------------
    # --- Waveform contender
    # ----------------------------------------------------
    # --- Init OFDM structure
    ofdm  = initOFDM(
                        nFFT,                           # --- nFFT                 : FFT size
                        72,                             # --- nCP                  : CP size
                        allocatedSubcarriers            # --- allocatedSubcarriers : Subcarrier allocation
                        );
    # --- Init SCFDMA structure
    scfdma  = initSCFDMA(
                            nFFT,                       # --- nFFT                 : FFT size
                            72,                         # --- nCP                  : CP size
                            allocatedSubcarriers,       # --- allocatedSubcarriers : Subcarrier allocation
                            12;                         # --- sizeDFT              : DFT preprocessing size
                            );
    # --- Init UF-OFDM structure
    ufofdm  = initUFOFDM(
                            nFFT,                       # --- nFFT                 : FFT size
                            73,                         # --- L                    : Filter length (same size +1 due to conv)
                            allocatedSubcarriers,       # --- allocatedSubcarriers : Subcarrier allocation
                            applyPD=1,                  # --- applyPD              : Do predistortion at Tx stage
                            attenuation=40,             # --- attenuation          : Filter attenuation in dB
                            );
    # --- Init BF-OFDM structure
    bfofdm  = initBFOFDM(
                            32,                         # --- nFBMC                : PPN size (max number of carriers)
                            64,                         # --- nOFDM                : Precoder size (OFDM sizer)
                            3,                          # --- K                    : Overlapping factor
                            9,                          # --- GI                   : CP size of precoder
                            0.5,                        # --- δ                    : compression factor
                            allocatedSubcarriers,       # --- allocatedSubcarriers : Subcarrier allocation
                            &quot;gaussian&quot;,                 # --- filterName           : Pulse shape name
                            BT=0.36,                    # --- BT                   : Potential BT value for Gaussian
                            filterStopBand = 110,       # --- filterStopBand       : DC stopband value
                            fS=[],                      # --- fS                   : Potential frequency coefficient for FS filter
                            nFFT= 1024,                 # --- nFFT                 : associated FFT value in Rx
                            nCP= 72,                    # --- nCP                  : extended CP size
                            );
    # --- Init WOLA-OFDM structure
    wola  = initWOLA(
                        nFFT,                           # --- nFFT                 : FFT size
                        72,                             # --- nCP                  : CP size
                        allocatedSubcarriers,           # --- allocatedSubcarriers : Subcarrier allocation
                        &quot;triangle&quot;,                     # --- Window type @Tx side
                        20,                             # --- Window size @Tx side
                        &quot;triangle&quot;,                     # --- Window type @Rx side
                        20,                             # --- Window size @Rx side
                        );
    fbmc  = initFBMC(
                        nFFT,                           # --- nFFT                 : FFT size
                        4,                              # --- K                    : Overlapping factor
                        allocatedSubcarriers            # --- allocatedSubcarriers : Subcarrier allocation
                        );
    # ----------------------------------------------------
    # --- Merging structures
    # ----------------------------------------------------
    # Create  a dictionnary to rule them all 
    waveforms   = initWaveforms(ofdm,
                                scfdma,
                                ufofdm,
                                bfofdm,
                                wola,
                                fbmc,
                                );
    # ---------------------------------------------------- 
    # --- PSD main calculation  
    # ---------------------------------------------------- 
    # --- Init plot container 
    plt     = plot(reuse=false);
    decim   = 1;    # decimation for light plots
    # --- Iterative PSD generation
    for (name,struc) in waveforms 
        # --- Calculate PSD for the configuration 
        (fe,psd)  = psdWaveform(struc,nbSymb,nbIt); 
        # Plot the result 
        plot!(plt,fe[1:decim:end].*samplingFreq,10 .* log10.(psd[1:decim:end]/maximum(psd)),label=name,legend=:topleft);
    end
    # --- Update plot and adding labels 
    # Purpose is to zoom out on allocated region.
    scsN        = (1/1024)*samplingFreq;    # Subscarrier spacing (normalized)
    rbV         = (12*12);                  # See several RB for psd fall-off
    ylims!(-120,5);
    xlims!(-rbV*scsN,maximum(allocatedSubcarriers)*scsN+2*12*scsN);
    xlabel!(&quot;Frequency [MHz]&quot;);
    ylabel!(&quot;Spectrum&quot;);
    display(plt)
end
end</code></pre><p>By running <code>example_PSD_waveform.main();</code> a comparison plot between the different PSD can be obtained</p><p><img src="../../img/psd.png" alt="PSD"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_BER/">« Compute the theoretical BER for AWGN channel and various constellation size</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Thursday 17 April 2025 14:56">Thursday 17 April 2025</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
